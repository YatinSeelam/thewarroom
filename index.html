<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The War Room Trenches</title>
    <!-- Tailwind CSS (via CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Supabase JS Library (v2) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <style>
        /* Fade Down for the header */
        @keyframes fadeDown {
            0% {
                opacity: 0;
                transform: translateY(-10px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fadeDown {
            animation: fadeDown 0.8s ease-out forwards;
        }

        /* Fade/Slide Up for main content */
        @keyframes fadeSlideUp {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fadeSlideUp {
            animation: fadeSlideUp 0.8s ease-out forwards;
        }

        /* Shimmer animation for sign-in button */
        @keyframes shimmer {
            0% {
                background-position: 0% 50%;
            }

            100% {
                background-position: 200% 50%;
            }
        }

        .btn-shimmer {
            background: linear-gradient(270deg, #8D6E63, #A1887F, #8D6E63, #A1887F);
            background-size: 400% 400%;
            animation: shimmer 6s ease infinite;
        }
    </style>
</head>

<body class="min-h-screen bg-gradient-to-b from-[#1a1611] to-[#24180f] text-[#e0d2c3]">
    <!-- Header -->
    <header class="bg-[#2a2018] border-b-2 border-[#8b5a2b] py-4 px-6 shadow-md animate-fadeDown">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-3xl font-bold text-[#d4a76a] tracking-wide">
                The War Room Trenches
            </h1>
            <div id="header-user-info" class="flex items-center gap-3">
                <!-- User info will be appended here when signed in -->
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main
        class="container mx-auto flex flex-col items-center justify-center min-h-[70vh] py-10 px-4 animate-fadeSlideUp">
        <!-- Sign-In Card -->
        <div id="sign-in-card"
            class="w-full max-w-md bg-[#2a2018] rounded-xl border border-[#8b5a2b] shadow-2xl p-8 text-center">
            <h2 class="text-3xl font-bold text-[#d4a76a] mb-4">Enter the War Room</h2>
            <p class="text-lg text-[#a08068] mb-8">
                Sign in with Google to join our secret council and lead world-changing discussions.
            </p>
            <button id="login"
                class="btn-shimmer text-[#3E2723] py-3 w-full rounded-full uppercase font-semibold tracking-wider shadow-md hover:scale-105 transition-transform duration-300">
                Sign In with Google
            </button>
        </div>

        <!-- Profile Card (visible once signed in) -->
        <div id="profile-card"
            class="hidden w-full max-w-md bg-[#2a2018] rounded-xl border border-[#8b5a2b] shadow-2xl p-8 text-center mt-8">
            <img id="profile-photo" class="w-24 h-24 mx-auto rounded-full border-4 border-[#D7CCC8] mb-4"
                src="https://via.placeholder.com/100" alt="Profile Photo" />
            <h2 class="text-2xl font-bold text-[#d4a76a]">Welcome,</h2>
            <p id="profile-name" class="text-3xl font-semibold mb-6">User</p>
            <button id="logout"
                class="bg-[#8b5a2b] text-[#f5efe6] px-6 py-2 rounded-full hover:bg-[#a06c33] transition-colors duration-200 shadow-md">
                Sign Out
            </button>
        </div>
    </main>

    <!-- Loading Screen (hidden by default) -->
    <div id="loading-screen" class="fixed inset-0 flex items-center justify-center bg-[#1a1611] hidden">
        <div class="flex flex-col items-center animate-fadeSlideUp">
            <div
                class="w-16 h-16 border-4 border-t-4 border-[#d4a76a] border-t-transparent rounded-full animate-spin mb-4">
            </div>
            <h2 class="text-[#d4a76a] text-xl font-medium animate-pulse">
                Loading War Room Trenches...
            </h2>
        </div>
    </div>

    <script>
        // 1. Supabase Initialization
        const supabaseUrl = 'https://rxnaepberqsnkmvtwmng.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4bmFlcGJlcnFzbmttdnR3bW5nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQyNDU1MzMsImV4cCI6MjA1OTgyMTUzM30.oCSYR99pGXb6laiaXplzg-G5Y_92PBYXOsijQrW3avo';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        // 2. DOM References
        const signInCard = document.getElementById('sign-in-card');
        const profileCard = document.getElementById('profile-card');
        const headerUserInfo = document.getElementById('header-user-info');
        const loginBtn = document.getElementById('login');
        const logoutBtn = document.getElementById('logout');
        const profilePhoto = document.getElementById('profile-photo');
        const profileName = document.getElementById('profile-name');
        const loadingScreen = document.getElementById('loading-screen');

        // 3. Loading Screen
        function showLoading(show) {
            if (show) {
                loadingScreen.classList.remove('hidden');
            } else {
                loadingScreen.classList.add('hidden');
            }
        }

        // Initially show loading
        showLoading(true);

        // 4. Update UI based on session
        function updateUI(session) {
            if (session && session.user) {
                // Hide sign-in card, show profile
                signInCard.classList.add('hidden');
                profileCard.classList.remove('hidden');

                const displayName = session.user.user_metadata.full_name || session.user.email || 'Warrior';
                const photoURL = session.user.user_metadata.avatar_url || 'https://via.placeholder.com/100';

                // Update profile card
                profilePhoto.src = photoURL;
                profileName.textContent = displayName;

                // Update header user info
                headerUserInfo.innerHTML = `
          <img src="${photoURL}" alt="${displayName}" class="w-8 h-8 rounded-full border border-[#8b5a2b] object-cover">
          <span class="text-[#d4a76a] font-semibold">${displayName}</span>
        `;
            } else {
                // Show sign-in card, hide profile
                signInCard.classList.remove('hidden');
                profileCard.classList.add('hidden');
                headerUserInfo.innerHTML = '';
            }
        }

        // 5. Check initial session
        supabase.auth.getSession().then(({ data: { session } }) => {
            updateUI(session);
            showLoading(false);
        });

        // 6. Listen for Auth State Changes
        supabase.auth.onAuthStateChange((_event, session) => {
            updateUI(session);
        });

        // 7. Sign In / Out Handlers
        loginBtn.addEventListener('click', async () => {
            showLoading(true);
            const { error } = await supabase.auth.signInWithOAuth({ provider: 'google' });
            if (error) {
                console.error('Error during sign-in:', error.message);
                showLoading(false);
            }
        });

        logoutBtn.addEventListener('click', async () => {
            const { error } = await supabase.auth.signOut();
            if (error) {
                console.error('Error during sign-out:', error.message);
            }
        });
    </script>
</body>

</html>
