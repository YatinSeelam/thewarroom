<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The War Room Trenches - Chat App</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Supabase JS CDN (v2) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <style>
        /* Custom Animations */
        @keyframes fadeSlideUp {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fadeSlideUp {
            animation: fadeSlideUp 0.8s ease-out forwards;
        }

        @keyframes fadeDown {
            0% {
                opacity: 0;
                transform: translateY(-10px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fadeDown {
            animation: fadeDown 0.8s ease-out forwards;
        }

        @keyframes shimmer {
            0% {
                background-position: 0% 50%;
            }

            100% {
                background-position: 200% 50%;
            }
        }

        .btn-shimmer {
            background: linear-gradient(270deg, #8D6E63, #A1887F, #8D6E63, #A1887F);
            background-size: 400% 400%;
            animation: shimmer 6s ease infinite;
        }
    </style>
</head>

<body class="bg-gradient-to-b from-[#1a1611] to-[#24180f] text-[#e0d2c3]">
    <!-- Header Section -->
    <header class="py-6 bg-[#2a2018] shadow-md animate-fadeDown">
        <div class="container mx-auto flex justify-center">
            <h1 class="text-4xl font-bold text-[#d4a76a] tracking-wide">The War Room Trenches</h1>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="container mx-auto flex flex-col items-center justify-center min-h-[80vh]">
        <!-- Sign-In Card (visible when not signed in) -->
        <div id="sign-in-card"
            class="max-w-md w-full bg-[#2a2018] rounded-xl shadow-2xl p-8 text-center border border-[#8b5a2b] animate-fadeSlideUp">
            <h2 class="text-3xl font-bold text-[#d4a76a] mb-4">Enter the War Room</h2>
            <p class="text-lg text-[#a08068] mb-8">
                Sign in with Google to join our secret council and strategize world-changing ideas.
            </p>
            <button id="login"
                class="w-full btn-shimmer text-[#3E2723] py-3 rounded-full uppercase tracking-wider font-semibold shadow-lg transform transition-all duration-300 hover:scale-105">
                Sign In with Google
            </button>
        </div>

        <!-- Profile Card (visible when signed in) -->
        <div id="profile-card"
            class="hidden max-w-md w-full bg-[#2a2018] rounded-xl shadow-2xl p-8 text-center border border-[#8b5a2b] animate-fadeSlideUp">
            <img id="profile-photo" class="w-24 h-24 mx-auto rounded-full border-4 border-[#D7CCC8] mb-4"
                src="https://via.placeholder.com/100" alt="Profile Photo">
            <h2 class="text-2xl font-bold text-[#d4a76a]">Welcome,</h2>
            <p id="profile-name" class="text-3xl font-semibold mb-4">User</p>
            <button id="logout"
                class="bg-[#8b5a2b] text-[#f5efe6] px-6 py-2 rounded-full hover:bg-[#a06c33] transition-colors duration-200 shadow-md">
                Sign Out
            </button>
        </div>
    </main>

    <!-- User Info Display (optional, can be removed if not used) -->
    <div id="user-info" class="container mx-auto mt-6 text-center animate-fadeSlideUp"></div>

    <!-- Loading Screen -->
    <div id="loading-screen" class="fixed inset-0 flex items-center justify-center bg-[#1a1611] hidden">
        <div class="flex flex-col items-center animate-fadeSlideUp">
            <div
                class="w-16 h-16 border-4 border-t-4 border-[#d4a76a] border-t-transparent rounded-full animate-spin mb-4">
            </div>
            <h2 class="text-[#d4a76a] text-xl font-medium animate-pulse">Loading War Room Trenches...</h2>
        </div>
    </div>

    <!-- Supabase Auth and UI Script -->
    <script>
        // Initialize the Supabase client
        const supabaseUrl = 'https://rxnaepberqsnkmvtwmng.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4bmFlcGJlcnFzbmttdnR3bW5nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQyNDU1MzMsImV4cCI6MjA1OTgyMTUzM30.oCSYR99pGXb6laiaXplzg-G5Y_92PBYXOsijQrW3avo';
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

        // DOM Element References
        const signInCard = document.getElementById('sign-in-card');
        const profileCard = document.getElementById('profile-card');
        const userInfoDiv = document.getElementById('user-info');
        const loginBtn = document.getElementById('login');
        const logoutBtn = document.getElementById('logout');
        const profilePhoto = document.getElementById('profile-photo');
        const profileName = document.getElementById('profile-name');
        const loadingScreen = document.getElementById('loading-screen');

        // Loading Screen Control
        function showLoading(show) {
            if (show) {
                loadingScreen.classList.remove('hidden');
            } else {
                loadingScreen.classList.add('hidden');
            }
        }
        // Initially show loading screen
        showLoading(true);

        // Update UI based on session
        async function updateUI(session) {
            if (session && session.user) {
                signInCard.classList.add('hidden');
                profileCard.classList.remove('hidden');

                const displayName = session.user.user_metadata.full_name || session.user.email || "User";
                const photoURL = session.user.user_metadata.avatar_url || "https://via.placeholder.com/100";

                profilePhoto.src = photoURL;
                profileName.textContent = displayName;
            } else {
                signInCard.classList.remove('hidden');
                profileCard.classList.add('hidden');
                userInfoDiv.innerHTML = "";
            }
        }

        // Check for an existing session on load
        supabaseClient.auth.getSession().then(({ data: { session } }) => {
            updateUI(session);
            showLoading(false);
        });

        // Listen for auth state changes
        supabaseClient.auth.onAuthStateChange((event, session) => {
            updateUI(session);
        });

        // Handle sign-in with Google
        loginBtn.addEventListener('click', async () => {
            const { error } = await supabaseClient.auth.signInWithOAuth({ provider: 'google' });
            if (error) {
                console.error('Error during Google sign-in:', error.message);
            }
        });

        // Handle sign-out
        if (logoutBtn) {
            logoutBtn.addEventListener('click', async () => {
                const { error } = await supabaseClient.auth.signOut();
                if (error) {
                    console.error('Error during sign out:', error.message);
                }
            });
        }
    </script>
</body>

</html>
